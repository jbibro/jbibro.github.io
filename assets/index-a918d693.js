(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const _ of o.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&s(_)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function ee(){}function Ve(n){return n()}function De(){return Object.create(null)}function de(n){n.forEach(Ve)}function Xe(n){return typeof n=="function"}function Qe(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function ft(n){return Object.keys(n).length===0}function j(n,e){n.appendChild(e)}function J(n,e,t){n.insertBefore(e,t||null)}function B(n){n.parentNode&&n.parentNode.removeChild(n)}function ut(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function q(n){return document.createElement(n)}function Ze(n){return document.createTextNode(n)}function X(){return Ze(" ")}function Ie(n,e,t,s){return n.addEventListener(e,t,s),()=>n.removeEventListener(e,t,s)}function _t(n){return function(e){return e.preventDefault(),n.call(this,e)}}function K(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function pt(n){return Array.from(n.childNodes)}function gt(n,e){e=""+e,n.wholeText!==e&&(n.data=e)}function Pe(n,e){n.value=e??""}let Ne;function ce(n){Ne=n}const Q=[],$e=[],pe=[],Le=[],mt=Promise.resolve();let Se=!1;function yt(){Se||(Se=!0,mt.then(et))}function Ae(n){pe.push(n)}const Ce=new Set;let V=0;function et(){if(V!==0)return;const n=Ne;do{try{for(;V<Q.length;){const e=Q[V];V++,ce(e),bt(e.$$)}}catch(e){throw Q.length=0,V=0,e}for(ce(null),Q.length=0,V=0;$e.length;)$e.pop()();for(let e=0;e<pe.length;e+=1){const t=pe[e];Ce.has(t)||(Ce.add(t),t())}pe.length=0}while(Q.length);for(;Le.length;)Le.pop()();Se=!1,Ce.clear(),ce(n)}function bt(n){if(n.fragment!==null){n.update(),de(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(Ae)}}const ge=new Set;let wt;function tt(n,e){n&&n.i&&(ge.delete(n),n.i(e))}function Et(n,e,t,s){if(n&&n.o){if(ge.has(n))return;ge.add(n),wt.c.push(()=>{ge.delete(n),s&&(t&&n.d(1),s())}),n.o(e)}else s&&s()}function Ct(n){n&&n.c()}function nt(n,e,t,s){const{fragment:i,after_update:o}=n.$$;i&&i.m(e,t),s||Ae(()=>{const _=n.$$.on_mount.map(Ve).filter(Xe);n.$$.on_destroy?n.$$.on_destroy.push(..._):de(_),n.$$.on_mount=[]}),o.forEach(Ae)}function st(n,e){const t=n.$$;t.fragment!==null&&(de(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Tt(n,e){n.$$.dirty[0]===-1&&(Q.push(n),yt(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function it(n,e,t,s,i,o,_,m=[-1]){const E=Ne;ce(n);const a=n.$$={fragment:null,ctx:[],props:o,update:ee,not_equal:i,bound:De(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(E?E.$$.context:[])),callbacks:De(),dirty:m,skip_bound:!1,root:e.target||E.$$.root};_&&_(a.root);let p=!1;if(a.ctx=t?t(n,e.props||{},(h,P,...k)=>{const w=k.length?k[0]:P;return a.ctx&&i(a.ctx[h],a.ctx[h]=w)&&(!a.skip_bound&&a.bound[h]&&a.bound[h](w),p&&Tt(n,h)),P}):[],a.update(),p=!0,de(a.before_update),a.fragment=s?s(a.ctx):!1,e.target){if(e.hydrate){const h=pt(e.target);a.fragment&&a.fragment.l(h),h.forEach(B)}else a.fragment&&a.fragment.c();e.intro&&tt(n.$$.fragment),nt(n,e.target,e.anchor,e.customElement),et()}ce(E)}class rt{$destroy(){st(this,1),this.$destroy=ee}$on(e,t){if(!Xe(t))return ee;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(t),()=>{const i=s.indexOf(t);i!==-1&&s.splice(i,1)}}$set(e){this.$$set&&!ft(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const Me=64*1024,Rt=5*1e3,St=5*1e3;function xe(n){const e=new Uint8Array(n);for(let t=0;t<n;t++)e[t]=Math.random()*256|0;return e}function ot(){if(typeof globalThis>"u")return null;const n={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return n.RTCPeerConnection?n:null}function g(n,e){return Object.defineProperty(n,"code",{value:e,enumerable:!0,configurable:!0}),n}function qe(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function At(n){console.warn(n)}class G{constructor(e={}){if(this._map=new Map,this._id=xe(4).toString("hex").slice(0,7),this._doDebug=e.debug,this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||xe(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||G.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},G.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(t=>t),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||Rt,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:ot(),!this._wrtc)throw g(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(t){this.destroy(g(t,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=t=>{this._onIceCandidate(t)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(t=>{this.destroy(g(t,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=t=>{this._setupData(t)},this.streams&&this.streams.forEach(t=>{this.addStream(t)}),this._pc.ontrack=t=>{this._onTrack(t)},this._debug("initial negotiation"),this._needsNegotiation()}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(t=>{this._addIceCandidate(t)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(t=>{this.destroy(g(t,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(g(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch(s=>{!t.address||t.address.endsWith(".local")?At("Ignoring unsupported ICE candidate."):this.destroy(g(s,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,t){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(s){this.destroy(g(s,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(t=>{this.addTrack(t,e)})}}addTrack(e,t){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const s=this._senderMap.get(e)||new Map;let i=s.get(t);if(!i)i=this._pc.addTrack(e,t),s.set(t,i),this._senderMap.set(e,s),this._needsNegotiation();else throw i.removed?g(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):g(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,t,s){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const i=this._senderMap.get(e),o=i?i.get(s):null;if(!o)throw g(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,i),o.replaceTrack!=null?o.replaceTrack(t):this.destroy(g(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const s=this._senderMap.get(e),i=s?s.get(t):null;if(!i)throw g(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{i.removed=!0,this._pc.removeTrack(i)}catch(o){o.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(i):this.destroy(g(o,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(t=>{this.removeTrack(t,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),queueMicrotask(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close")}))}_setupData(e){if(!e.channel)return this.destroy(g(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=Me),this.channelName=this._channel.label,this._channel.onmessage=s=>{this._onChannelMessage(s)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=s=>{this.destroy(g(s,"ERR_DATA_CHANNEL"))};let t=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(t&&this._onChannelClose(),t=!0):t=!1},St)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=qe(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp})},s=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))},i=o=>{this.destroy(g(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(i)}).catch(e=>{this.destroy(g(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=qe(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp}),this.initiator||this._requestMissingTransceivers()},s=()=>{this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))},i=o=>{this.destroy(g(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(i)}).catch(e=>{this.destroy(g(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(g(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(g(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(g(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const t=s=>(Object.prototype.toString.call(s.values)==="[object Array]"&&s.values.forEach(i=>{Object.assign(s,i)}),s);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(s=>{const i=[];s.forEach(o=>{i.push(t(o))}),e(null,i)},s=>e(s)):this._pc.getStats.length>0?this._pc.getStats(s=>{if(this.destroyed)return;const i=[];s.result().forEach(o=>{const _={};o.names().forEach(m=>{_[m]=o.stat(m)}),_.id=o.id,_.type=o.type,_.timestamp=o.timestamp,i.push(t(_))}),e(null,i)},s=>e(s)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((t,s)=>{if(this.destroyed)return;t&&(s=[]);const i={},o={},_={};let m=!1;s.forEach(a=>{(a.type==="remotecandidate"||a.type==="remote-candidate")&&(i[a.id]=a),(a.type==="localcandidate"||a.type==="local-candidate")&&(o[a.id]=a),(a.type==="candidatepair"||a.type==="candidate-pair")&&(_[a.id]=a)});const E=a=>{m=!0;let p=o[a.localCandidateId];p&&(p.ip||p.address)?(this.localAddress=p.ip||p.address,this.localPort=Number(p.port)):p&&p.ipAddress?(this.localAddress=p.ipAddress,this.localPort=Number(p.portNumber)):typeof a.googLocalAddress=="string"&&(p=a.googLocalAddress.split(":"),this.localAddress=p[0],this.localPort=Number(p[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let h=i[a.remoteCandidateId];h&&(h.ip||h.address)?(this.remoteAddress=h.ip||h.address,this.remotePort=Number(h.port)):h&&h.ipAddress?(this.remoteAddress=h.ipAddress,this.remotePort=Number(h.portNumber)):typeof a.googRemoteAddress=="string"&&(h=a.googRemoteAddress.split(":"),this.remoteAddress=h[0],this.remotePort=Number(h[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(s.forEach(a=>{a.type==="transport"&&a.selectedCandidatePairId&&E(_[a.selectedCandidatePairId]),(a.type==="googCandidatePair"&&a.googActiveConnection==="true"||(a.type==="candidatepair"||a.type==="candidate-pair")&&a.selected)&&E(a)}),!m&&(!Object.keys(_).length||Object.keys(o).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(p){return this.destroy(g(p,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const a=this._cb;this._cb=null,a(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>Me||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let t=e.data;t instanceof ArrayBuffer&&(t=new Uint8Array(t)),this.emit("data",t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),!this._remoteStreams.some(s=>s.id===t.id)&&(this._remoteStreams.push(t),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",t)}))})}_debug(...e){this._doDebug&&(e[0]="["+this._id+"] "+e[0],console.log(...e))}on(e,t){const s=this._map;s.has(e)||s.set(e,new Set),s.get(e).add(t)}off(e,t){const s=this._map,i=s.get(e);i&&(i.delete(t),i.size===0&&s.delete(e))}once(e,t){const s=(...i)=>{this.off(e,s),t(...i)};this.on(e,s)}emit(e,...t){const s=this._map;if(s.has(e))for(const i of s.get(e))try{i(...t)}catch(o){console.error(o)}}}G.WEBRTC_SUPPORT=!!ot();G.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};G.channelConfig={};const Ue="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",Be=(n,e,t)=>{const s=new G({initiator:n,trickle:e,config:t}),i=o=>s.__earlyDataBuffer.push(o);return s.on(O.data,i),s.__earlyDataBuffer=[],s.__drainEarlyData=o=>{s.off(O.data,i),s.__earlyDataBuffer.forEach(o),delete s.__earlyDataBuffer,delete s.__drainEarlyData},s},at=n=>new Array(n).fill().map(()=>Ue[Math.floor(Math.random()*Ue.length)]).join(""),kt=(n,e)=>(t,s)=>{if(n[s])throw I(`already joined room ${s}`);if(!t)throw I("requires a config map as the first argument");if(!t.appId&&!t.firebaseApp)throw I("config map is missing appId field");if(!s)throw I("namespace argument required");return e(t,s)},le="Trystero",me=at(20),{keys:je,values:Nt,entries:ke,fromEntries:ct}=Object,z=()=>{},I=n=>new Error(`${le}: ${n}`),Z=n=>new TextEncoder().encode(n),re=n=>new TextDecoder().decode(n),O=ct(["close","connect","data","error","signal","stream","track"].map(n=>[n,n])),vt=n=>{const e=new Uint8Array(n.reduce((t,s)=>t+s.byteLength,0));return n.reduce((t,s)=>(e.set(s,t),t+s.byteLength),0),e},Ot=Object.getPrototypeOf(Uint8Array),ye=12,lt=0,be=lt+ye,we=be+1,oe=we+1,ae=oe+1,W=16*2**10-ae,_e=255,He="bufferedamountlow",Dt=(n,e)=>{const t={},s={},i={},o={},_={},m={},E=(r,l)=>(r?Array.isArray(r)?r:[r]:je(t)).flatMap(b=>{const u=t[b];return u?l(b,u):(console.warn(`${le}: no peer with id ${b} found`),[])}),a=r=>{t[r]&&(delete t[r],delete i[r],delete o[r],d(r))},p=r=>{if(!r)throw I("action type argument is required");const l=Z(r);if(l.byteLength>ye)throw I(`action type string "${r}" (${l.byteLength}b) exceeds byte limit (${ye}). Hint: choose a shorter name.`);const b=new Uint8Array(ye);b.set(l);const u=re(b);if(s[u])throw I(`action '${r}' already registered`);let A=0;return s[u]={onComplete:z,onProgress:z},[async(T,te,D,he)=>{if(D&&typeof D!="object")throw I("action meta argument must be an object");if(T===void 0)throw I("action data cannot be undefined");const fe=typeof T!="string",ue=T instanceof Blob,ne=ue||T instanceof ArrayBuffer||T instanceof Ot;if(D&&!ne)throw I("action meta argument can only be used with binary data");const M=ne?new Uint8Array(ue?await T.arrayBuffer():T):Z(fe?JSON.stringify(T):T),se=D?Z(JSON.stringify(D)):null,H=Math.ceil(M.byteLength/W)+(D?1:0),dt=new Array(H).fill().map((Ee,x)=>{const Y=x===H-1,F=D&&x===0,U=new Uint8Array(ae+(F?se.byteLength:Y?M.byteLength-W*(H-(D?2:1)):W));return U.set(b),U.set([A],be),U.set([Y|F<<1|ne<<2|fe<<3],we),U.set([Math.round((x+1)/H*_e)],oe),U.set(D?F?se:M.subarray((x-1)*W,x*W):M.subarray(x*W,(x+1)*W),ae),U});return A=A+1&_e,Promise.all(E(te,async(Ee,x)=>{const Y=x._channel;let F=0;for(;F<H;){const U=dt[F];if(Y.bufferedAmount>Y.bufferedAmountLowThreshold&&await new Promise(ht=>{const Oe=()=>{Y.removeEventListener(He,Oe),ht()};Y.addEventListener(He,Oe)}),!t[Ee])break;x.send(U),F++,he&&he(U[oe]/_e,Ee,D)}}))},T=>s[u]={...s[u],onComplete:T},T=>s[u]={...s[u],onProgress:T}]},h=(r,l)=>{const b=new Uint8Array(l),u=re(b.subarray(lt,be)),[A]=b.subarray(be,we),[T]=b.subarray(we,oe),[te]=b.subarray(oe,ae),D=b.subarray(ae),he=!!(T&1),fe=!!(T&1<<1),ue=!!(T&1<<2),ne=!!(T&1<<3);if(!s[u])throw I(`received message with unregistered type (${u})`);i[r]||(i[r]={}),i[r][u]||(i[r][u]={});let M=i[r][u][A];if(M||(M=i[r][u][A]={chunks:[]}),fe?M.meta=JSON.parse(re(D)):M.chunks.push(D),s[u].onProgress(te/_e,r,M.meta),!he)return;const se=vt(M.chunks);if(ue)s[u].onComplete(se,r,M.meta);else{const H=re(se);s[u].onComplete(ne?JSON.parse(H):H,r)}delete i[r][u][A]},[P,k]=p("__91n6__"),[w,$]=p("__90n6__"),[L,S]=p("__516n4L__"),[f,C]=p("__57r34m__"),[c,y]=p("__7r4ck__");let R=z,d=z,v=z,N=z;return n((r,l)=>{if(t[l])return;const b=h.bind(null,l);t[l]=r,r.on(O.signal,u=>L(u,l)),r.on(O.close,()=>a(l)),r.on(O.data,b),r.on(O.stream,u=>{v(u,l,_[l]),delete _[l]}),r.on(O.track,(u,A)=>{N(u,A,l,m[l]),delete m[l]}),r.on(O.error,u=>{u.code!=="ERR_DATA_CHANNEL"&&console.error(u)}),R(l),r.__drainEarlyData(b)}),k((r,l)=>w(null,l)),$((r,l)=>{o[l]&&(o[l](),delete o[l])}),S((r,l)=>{t[l]&&t[l].signal(r)}),C((r,l)=>_[l]=r),y((r,l)=>m[l]=r),{makeAction:p,ping:async r=>{if(!r)throw I("ping() must be called with target peer ID");const l=Date.now();return P(null,r),await new Promise(b=>o[r]=b),Date.now()-l},leave:()=>{ke(t).forEach(([r,l])=>{l.destroy(),delete t[r]}),e()},getPeers:()=>je(t),addStream:(r,l,b)=>E(l,async(u,A)=>{b&&await f(b,u),A.addStream(r)}),removeStream:(r,l)=>E(l,(b,u)=>u.removeStream(r)),addTrack:(r,l,b,u)=>E(b,async(A,T)=>{u&&await c(u,A),T.addTrack(r,l)}),removeTrack:(r,l,b)=>E(b,(u,A)=>A.removeTrack(r,l)),replaceTrack:(r,l,b,u,A)=>E(u,async(T,te)=>{A&&await c(A,T),te.replaceTrack(r,l,b)}),onPeerJoin:r=>R=r,onPeerLeave:r=>d=r,onPeerStream:r=>v=r,onPeerTrack:r=>N=r}},ve="AES-CBC",It=n=>window.btoa(String.fromCharCode.apply(null,new Uint8Array(n))),Pt=n=>{const e=window.atob(n);return new Uint8Array(e.length).map((t,s)=>e.charCodeAt(s)).buffer},$t=async(n,e)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},Z(`${n}:${e}`)),{name:ve},!1,["encrypt","decrypt"]),Je=async(n,e)=>{const t=crypto.getRandomValues(new Uint8Array(16));return JSON.stringify({c:It(await crypto.subtle.encrypt({name:ve,iv:t},await n,Z(e))),iv:[...t]})},Ye=async(n,e)=>{const{c:t,iv:s}=JSON.parse(e);return re(await crypto.subtle.decrypt({name:ve,iv:new Uint8Array(s)},await n,Pt(t)))},Te={},Re={},ie={},Fe=20,We=10,Lt=2,Mt=33,xt=120,ze="announce",qt=["wss://tracker.openwebtorrent.com","wss://tracker.btorrent.xyz","wss://tracker.files.fm:7073/announce","wss://qot.abiir.top:443/announce","wss://spacetradersapi-chatbox.herokuapp.com:443/announce"],Ut=kt(Te,(n,e)=>{const t={},s=n.password&&$t(n.password,e),i=(n.trackerUrls||qt).slice(0,n.trackerUrls?n.trackerUrls.length:n.trackerRedundancy||Lt);if(!i.length)throw I("trackerUrls is empty");const o=crypto.subtle.digest("SHA-1",Z(`${le}:${n.appId}:${e}`)).then(c=>Array.from(new Uint8Array(c)).map(y=>y.toString(36)).join("").slice(0,Fe)),_=c=>ct(new Array(c).fill().map(()=>{const y=Be(!0,!1,n.rtcConfig);return[at(Fe),{peer:y,offerP:new Promise(R=>y.once(O.signal,R))}]})),m=()=>_(We),E=async(c,y)=>{const R=await o;let d;try{d=JSON.parse(y.data)}catch{console.error(`${le}: received malformed SDP JSON`);return}if(d.info_hash!==R||d.peer_id&&d.peer_id===me)return;const v=d["failure reason"];if(v){console.warn(`${le}: torrent tracker failure (${v})`);return}if(d.interval&&d.interval>$&&d.interval<=xt&&(clearInterval(L),$=d.interval,L=setInterval(h,$*1e3)),d.offer&&d.offer_id){if(t[d.peer_id]||f[d.offer_id])return;f[d.offer_id]=!0;const N=Be(!1,!1,n.rtcConfig);N.once(O.signal,async r=>c.send(JSON.stringify({answer:s?{...r,sdp:await Je(s,r.sdp)}:r,action:ze,info_hash:R,peer_id:me,to_peer_id:d.peer_id,offer_id:d.offer_id}))),N.on(O.connect,()=>k(N,d.peer_id)),N.on(O.close,()=>w(N,d.peer_id,d.offer_id)),N.signal(s?{...d.offer,sdp:await Ye(s,d.offer.sdp)}:d.offer);return}if(d.answer){if(t[d.peer_id]||f[d.offer_id])return;const N=C[d.offer_id];if(N){const{peer:r}=N;if(r.destroyed)return;f[d.offer_id]=!0,r.on(O.connect,()=>k(r,d.peer_id,d.offer_id)),r.on(O.close,()=>w(r,d.peer_id,d.offer_id)),r.signal(s?{...d.answer,sdp:await Ye(s,d.answer.sdp)}:d.answer)}}},a=async(c,y)=>c.send(JSON.stringify({action:ze,info_hash:y,numwant:We,peer_id:me,offers:await Promise.all(ke(C).map(async([R,{offerP:d}])=>{const v=await d;return{offer_id:R,offer:s?{...v,sdp:await Je(s,v.sdp)}:v}}))})),p=(c,y,R)=>(R||!Re[c]?(ie[c]={...ie[c],[y]:E},Re[c]=new Promise(d=>{const v=new WebSocket(c);v.onopen=d.bind(null,v),v.onmessage=N=>Nt(ie[c]).forEach(r=>r(v,N))})):ie[c][y]=E,Re[c]),h=async()=>{const c=await o;C&&P(),C=m(),i.forEach(async y=>{const R=await p(y,c);R.readyState===WebSocket.OPEN?a(R,c):R.readyState!==WebSocket.CONNECTING&&a(await p(y,c,!0),c)})},P=()=>{ke(C).forEach(([c,{peer:y}])=>{!f[c]&&!t[c]&&y.destroy()}),f={}},k=(c,y,R)=>{S(c,y),t[y]=!0,R&&(t[R]=!0)},w=(c,y,R)=>{delete t[y],c.destroy(),R in C&&(delete C[R],C={...C,..._(1)})};let $=Mt,L=setInterval(h,$*1e3),S=z,f={},C;return Te[e]=!0,h(),Dt(c=>S=c,async()=>{const c=await o;i.forEach(y=>delete ie[y][c]),delete Te[e],clearInterval(L),P()})});function Ge(n,e,t){const s=n.slice();return s[19]=e[t],s}function Ke(n){let e,t,s=n[19]+"",i,o;return{c(){e=q("li"),t=q("span"),i=Ze(s),o=X()},m(_,m){J(_,e,m),j(e,t),j(t,i),j(e,o)},p(_,m){m&2&&s!==(s=_[19]+"")&&gt(i,s)},d(_){_&&B(e)}}}function Bt(n){let e,t,s,i,o,_,m,E,a,p,h,P,k,w,$,L=n[1],S=[];for(let f=0;f<L.length;f+=1)S[f]=Ke(Ge(n,L,f));return{c(){e=q("h1"),e.textContent="No-way chat",t=X(),s=q("p"),s.textContent=`Your id: ${me}`,i=X(),o=q("ul");for(let f=0;f<S.length;f+=1)S[f].c();_=X(),m=q("form"),E=q("p"),a=q("label"),a.textContent="Message",p=X(),h=q("input"),P=X(),k=q("button"),k.textContent="Send",K(a,"for","msg"),K(h,"type","text"),K(h,"id","msg"),K(h,"name","msg"),K(k,"type","submit"),K(k,"id","send")},m(f,C){J(f,e,C),J(f,t,C),J(f,s,C),J(f,i,C),J(f,o,C);for(let c=0;c<S.length;c+=1)S[c].m(o,null);J(f,_,C),J(f,m,C),j(m,E),j(E,a),j(E,p),j(E,h),Pe(h,n[0]),j(m,P),j(m,k),w||($=[Ie(h,"input",n[3]),Ie(m,"submit",_t(n[2]))],w=!0)},p(f,[C]){if(C&2){L=f[1];let c;for(c=0;c<L.length;c+=1){const y=Ge(f,L,c);S[c]?S[c].p(y,C):(S[c]=Ke(y),S[c].c(),S[c].m(o,null))}for(;c<S.length;c+=1)S[c].d(1);S.length=L.length}C&1&&h.value!==f[0]&&Pe(h,f[0])},i:ee,o:ee,d(f){f&&B(e),f&&B(t),f&&B(s),f&&B(i),f&&B(o),ut(S,f),f&&B(_),f&&B(m),w=!1,de($)}}}function jt(n,e,t){let s="";new TextEncoder,new TextDecoder;let i=[];const o=w=>{t(1,i=[...i,w])},m=Ut({appId:"no-way-app"},"no-way-room"),[E,a]=m.makeAction("message"),[p,h]=m.makeAction("name");m.onPeerJoin(w=>{console.log(`${w} joined`),o(w+" joined"),p(nick,w)}),m.onPeerLeave(w=>{console.log(`${w} left`),o(w+" left")}),m.getPeers().forEach(w=>o(w+" joined")),a((w,$)=>{console.log(`got a ${w.msg} from ${$}`),o($+": "+w.msg)});async function P(w){E({msg:s}),o("Me: "+s),t(0,s="")}function k(){s=this.value,t(0,s)}return[s,i,P,k]}class Ht extends rt{constructor(e){super(),it(this,e,jt,Bt,Qe,{})}}function Jt(n){let e,t;return e=new Ht({}),{c(){Ct(e.$$.fragment)},m(s,i){nt(e,s,i),t=!0},p:ee,i(s){t||(tt(e.$$.fragment,s),t=!0)},o(s){Et(e.$$.fragment,s),t=!1},d(s){st(e,s)}}}class Yt extends rt{constructor(e){super(),it(this,e,null,Jt,Qe,{})}}new Yt({target:document.getElementById("app")});
